# 共享存储功能使用说明

## 功能说明

共享存储功能允许团队成员共享以下数据：
- ✅ **装备表**：一个人上传后，所有人可见
- ✅ **英雄表**：一个人上传后，所有人可见
- ✅ **怪物表**：一个人上传后，所有人可见
- ✅ **方案配置**：一个人保存的方案，其他人切换时能看到相同的配置

## 使用步骤

### 第一步：创建GitHub Gist

1. **访问GitHub Gist**
   - 打开：https://gist.github.com
   - 使用GitHub账号登录（如果没有账号，需要先注册）

2. **创建新的Gist**
   - 点击页面右上角的 **"+"** 或直接开始输入
   - **文件名**：输入 `battle-simulator-data.json`（或任意名称）
   - **内容**：可以留空，或输入 `{}`（空JSON对象）
   - **重要**：选择 **"Create public gist"**（公开Gist）
   - 点击 **"Create public gist"** 按钮

3. **复制Gist ID**
   - 创建成功后，URL会变成类似：
     ```
     https://gist.github.com/用户名/abc123def456ghi789jkl012mno345pq
     ```
   - **Gist ID**就是URL中的32位字符：`abc123def456ghi789jkl012mno345pq`
   - 复制这个ID

### 第二步：在网页中配置Gist ID

1. **打开战斗模拟器网页**
2. **找到"方案管理"区域**
3. **在"共享存储配置"部分**：
   - 将复制的Gist ID粘贴到输入框
   - 点击 **"保存Gist ID"** 按钮
   - 看到"Gist ID已保存"提示

### 第三步：上传数据到共享存储

#### 方法一：使用"上传到共享存储"按钮（推荐）

1. **上传表格**：
   - 上传装备表、英雄表、怪物表（这些会自动保存到本地）
   - 配置方案并保存

2. **点击"📤 上传到共享存储"按钮**
   - 会提示输入GitHub Personal Access Token
   - 输入Token（见下方"创建Token"说明）
   - 等待上传完成

#### 方法二：手动复制到Gist

1. **导出数据**：
   - 在浏览器控制台（F12）执行：
     ```javascript
     const data = {
         equipmentTable: JSON.parse(localStorage.getItem('battleSimulatorEquipmentTable') || '[]'),
         heroTable: JSON.parse(localStorage.getItem('battleSimulatorHeroTable') || '[]'),
         monsterTable: JSON.parse(localStorage.getItem('battleSimulatorMonsterTable') || '[]'),
         schemes: JSON.parse(localStorage.getItem('battleSimulatorSchemes') || '[]')
     };
     console.log(JSON.stringify(data, null, 2));
     ```
   - 复制输出的JSON数据

2. **粘贴到Gist**：
   - 打开你的Gist
   - 编辑文件，粘贴JSON数据
   - 点击 **"Update public gist"**

### 第四步：其他人同步数据

1. **配置相同的Gist ID**
   - 其他人也在网页中输入相同的Gist ID
   - 点击 **"保存Gist ID"**

2. **点击"🔄 从共享存储同步"按钮**
   - 等待同步完成
   - 看到"同步成功"提示
   - 所有表格和方案都会自动加载

## 创建GitHub Personal Access Token

如果需要上传数据到共享存储，需要创建Token：

1. **访问Token设置页面**
   - https://github.com/settings/tokens
   - 或：GitHub → Settings → Developer settings → Personal access tokens → Tokens (classic)

2. **生成新Token**
   - 点击 **"Generate new token"** → **"Generate new token (classic)"**

3. **配置Token**
   - **Note**：`战斗模拟器共享存储`（备注，任意填写）
   - **Expiration**：选择有效期（建议90天或更长）
   - **Select scopes**：勾选 **`gist`**（Gist相关权限）

4. **生成并复制Token**
   - 点击 **"Generate token"**
   - **重要**：立即复制Token（只显示一次，类似 `ghp_xxxxxxxxxxxxxxxxxxxx`）
   - 保存好Token，上传数据时需要用到

## 使用场景

### 场景1：团队协作
- **管理员**：上传所有表格，配置方案，上传到共享存储
- **团队成员**：配置相同的Gist ID，点击同步，即可获得所有数据

### 场景2：数据更新
- **更新表格**：管理员上传新表格，重新上传到共享存储
- **其他人**：点击"从共享存储同步"，获得最新数据

### 场景3：方案共享
- **配置方案**：一个人配置好方案并保存，上传到共享存储
- **其他人**：同步后，在方案列表中可以看到并切换使用

## 注意事项

### ⚠️ 重要提示

1. **Gist必须是公开的**
   - 只有公开Gist才能被所有人访问
   - 私有Gist需要Token才能读取

2. **Token安全**
   - Token相当于密码，不要分享给他人
   - 如果Token泄露，立即在GitHub上删除并重新创建

3. **数据冲突**
   - 如果多人同时上传，后上传的会覆盖先上传的
   - 建议指定一个人负责上传数据

4. **Gist ID共享**
   - 所有人使用**同一个Gist ID**
   - 这样数据才会共享

5. **同步时机**
   - 建议在开始使用前先同步一次
   - 如果发现数据不是最新的，可以再次同步

## 常见问题

### Q1: 同步失败，提示"无法访问Gist"
**解决**：
- 检查Gist ID是否正确
- 确认Gist是公开的（Public）
- 检查网络连接

### Q2: 上传失败，提示"Bad credentials"
**解决**：
- 检查Personal Access Token是否正确
- 确认Token有`gist`权限
- Token可能已过期，重新创建

### Q3: 同步后数据没有更新
**解决**：
- 清除浏览器缓存
- 刷新页面后再次同步
- 检查Gist中的数据是否已更新

### Q4: 可以只共享表格，不共享方案吗？
**可以**：
- 上传时，只上传表格数据
- 或者在上传前，清空方案数据

### Q5: 如何更换Gist？
**操作**：
- 创建新的Gist，获取新的Gist ID
- 在网页中输入新的Gist ID并保存
- 上传数据到新Gist

## 技术说明

- **存储方式**：使用GitHub Gist作为共享存储
- **数据格式**：JSON格式
- **访问方式**：通过GitHub API读取和写入
- **本地备份**：数据同时保存在浏览器localStorage中

## 推荐工作流程

1. **初始化**（只需一次）：
   - 创建GitHub Gist
   - 所有人配置相同的Gist ID

2. **日常使用**：
   - 管理员上传表格和配置方案
   - 管理员上传到共享存储
   - 其他人点击同步获取最新数据

3. **更新数据**：
   - 管理员更新表格
   - 重新上传到共享存储
   - 其他人同步更新

---

**提示**：如果不想使用GitHub Gist，也可以使用其他共享存储方案，如Firebase、Supabase等，但需要修改代码。
